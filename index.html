<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç¶¸ç¶¸é¤é£²åº— ç·šä¸Šé»é¤ç³»çµ±</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f6f6f6;
      padding: 20px;
      font-size: 16px;
    }
    h1 {
      text-align: center;
      font-size: 24px;
    }
    .category {
      margin-top: 30px;
    }
    .category h2 {
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
      font-size: 20px;
    }
    .menu-item {
      background: #fff;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 16px;
      flex-wrap: wrap; /* è®“é …ç›®åœ¨å°è¢å¹•ä¸Šå¯ä»¥æ›è¡Œ */
    }
    .menu-item .item-info {
      flex: 2;
      min-width: 150px;
    }
    .menu-item .quantity-group {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 5px;
      min-width: 150px;
    }
    .btn {
      padding: 6px 10px;
      cursor: pointer;
      background-color: #ff9800;
      color: white;
      border: none;
      border-radius: 4px;
      margin: 5px 5px 5px 0;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
    }
    .btn:hover {
      background-color: #e68900;
    }
    #menu-view, #cart-view {
      display: none;
    }
    .form-group {
      margin: 10px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-size: 16px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>ç¶¸ç¶¸é¤é£²åº— ç·šä¸Šé»é¤ç³»çµ±</h1>

  
<div id="success-view" style="display:none;">
  <h2>æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼</h2>
  <p>æˆ‘å€‘å°‡ç‚ºæ‚¨æº–å‚™é¤é»ï¼Œé è¨ˆæ™‚é–“ç‚º 10~15 åˆ†é˜ï¼Œå¦‚é‡å°–å³°æ™‚æ®µé‚„è«‹æ‚¨è€å¿ƒç­‰å€™ã€‚<br>é€ æˆä¸ä¾¿ï¼Œæ•¬è«‹è¦‹è«’ï¼</p>
  <p style="color: red;">ã€æ³¨æ„ã€‘æ­¤ç‚ºæœ¬åœ°æ¸¬è©¦ç‰ˆï¼Œè¨‚å–®åªå„²å­˜åœ¨æ‚¨æœ¬æ©Ÿç€è¦½å™¨ï¼Œæ²’æœ‰å¯¦éš›é€å‡ºçµ¦åº—å®¶ã€‚</p>
</div>

  <div id="menu-view">
    <div id="menu"></div>
    <button class="btn" onclick="showCart()">æŸ¥çœ‹è³¼ç‰©è»Š</button>
  </div>

  <div id="cart-view">
    <h2>ğŸ›’ è³¼ç‰©è»Šé é¢</h2>
    <ul id="cart-list"></ul>
    <p>ğŸ’µ ç¸½é‡‘é¡ï¼š<span id="total">0</span> å…ƒ</p>

    <div class="form-group">
      <label for="name">å§“åï¼š</label>
      <input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å">
    </div>
    <div class="form-group">
      <label for="phone">é›»è©±ï¼š</label>
      <input type="text" id="phone" placeholder="è«‹è¼¸å…¥é›»è©±">
    </div>
    <div class="form-group">
      <label for="orderType">ç”¨é¤æ–¹å¼ï¼š</label>
      <select id="orderType" onchange="toggleAddress()">
        <option value="å…§ç”¨">å…§ç”¨</option>
        <option value="å¤–å¸¶">å¤–å¸¶</option>
        <option value="å¤–é€">å¤–é€</option>
      </select>
    </div>
    <div class="form-group" id="addressGroup" style="display:none">
      <label for="address">åœ°å€ï¼ˆé™å¤–é€å¡«å¯«ï¼‰ï¼š</label>
      <input type="text" id="address" placeholder="è«‹è¼¸å…¥å¤–é€åœ°å€">
    </div>
    <div class="form-group">
      <label for="payment">ä»˜æ¬¾æ–¹å¼ï¼š</label>
      <select id="payment" onchange="toggleBarcode()">
        <option value="ç¾é‡‘">ç¾é‡‘</option>
        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
        <option value="LINE PAY">LINE PAY</option>
        <option value="APPLE PAY">APPLE PAY</option>
      </select>

<div class="form-group" id="barcodeGroup" style="display:none">
  <label id="barcodeLabel" for="barcodeInput">è«‹è¼¸å…¥ä»˜æ¬¾ç¢¼ï¼š</label>
  <input type="text" id="barcodeInput" placeholder="è«‹è¼¸å…¥ä»˜æ¬¾ç¢¼">
</div>
    </div>

    <div class="form-group">
      <label for="invoiceType">ç™¼ç¥¨çµ¦äºˆæ–¹å¼ï¼š</label>
      <select id="invoiceType" onchange="toggleInvoiceFields()">
        <option value="ç´™æœ¬ç™¼ç¥¨">ç´™æœ¬ç™¼ç¥¨</option>
        <option value="è¼‰å…·">è¼‰å…·</option>
        <option value="çµ±ç·¨">çµ±ç·¨</option>
      </select>
    </div>

    <div class="form-group" id="carrierGroup" style="display:none">
      <label for="carrier">è¼‰å…·æ¢ç¢¼ï¼š</label>
      <input type="text" id="carrier" placeholder="è«‹è¼¸å…¥è¼‰å…·æ¢ç¢¼">
    </div>

    <div class="form-group" id="taxIdGroup" style="display:none">
      <label for="taxId">çµ±ä¸€ç·¨è™Ÿï¼š</label>
      <input type="text" id="taxId" placeholder="è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿ">
    </div>

    <div class="form-group">
       <label for="notes">å‚™è¨»ï¼š</label>
       <textarea id="notes" rows="3" placeholder="ä¾‹å¦‚ï¼šé£¯å°‘ä¸€é»ã€ä¸è¦è”¥ã€é€é¤å‰è«‹é›»è¯..."></textarea>
    </div>


    <button class="btn" onclick="submitOrder()">é€å‡ºè¨‚å–®</button>
    <button class="btn" onclick="removeItems()">æ¸…ç©ºè³¼ç‰©è»Š</button>
    <button class="btn" onclick="showMenu()">å›åˆ°é¸å–®</button>
    <p id="message"></p>
  </div>

  <script>
    const menuItems = {
      "é£¯é¡": [
        { name: "é›è‚‰è“‹é£¯", price: 80 },
        { name: "ç‰›è‚‰é‹å·´", price: 80 },
        { name: "æ‰“æ‹‹è±¬é£¯", price: 75 },
        { name: "æ‰“æ‹‹ç‰›é£¯", price: 90 },
        { name: "ç‰›è‚‰æ‹¼ç›¤", price: 185 },
        { name: "ç‰›è‚‰ç‚’é£¯", price: 90 },
        { name: "ç‚’é£¯", price: 55 },
        { name: "å’–å“©é£¯", price: 65 },
        { name: "è›‹åŒ…é£¯", price: 65 },
        { name: "è±¬è‚‰è“‹é£¯", price: 75 }
      ],
      "éºµé¡": [
        { name: "ç‚’éºµ", price: 55 },
        { name: "å’–å“©éºµ", price: 65 },
        { name: "ç‰›è‚‰ç‚’éºµ", price: 90 },
        { name: "ç‰›è‚‰éºµ(å°)", price: 100 },
        { name: "ç‰›è‚‰éºµ(å¤§)", price: 120 },
        { name: "ç‰›è‚‰æ¹¯éºµ(ç„¡è‚‰)", price: 70 },
        { name: "ç‚’æ³¡éºµ", price: 65 },
        { name: "ç«é›éºµ", price: 85 },
        { name: "å°é¾è¦éºµ", price: 90 },
        { name: "éº»é†¬éºµ", price: 55 },
        { name: "é¤›é£©éºµ", price: 80 },
        { name: "æ‹Œéºµ(ä¹¾)", price: 50 },
        { name: "æ¦¨èœè‚‰çµ²éºµ(æ¹¯/ä¹¾)", price: 55 }
      ],
      "æ¹¯é¡": [
        { name: "é­šä¸¸æ¹¯", price: 45 },
        { name: "ç‰›è‚‰æ¹¯", price: 80 },
        { name: "è²¢ä¸¸æ¹¯", price: 50 },
        { name: "å‘³å™Œæ¹¯", price: 50 },
        { name: "æ¸…æ¹¯", price: 45 },
        { name: "é¤›é£©æ¹¯", price: 70 }
      ]
    };

    const cart = [];

    function renderMenu() {
      const menuDiv = document.getElementById("menu");
      menuDiv.innerHTML = ''; // æ–°å¢æ¸…ç©ºï¼Œé¿å…é‡è¤‡æ¸²æŸ“
      Object.keys(menuItems).forEach(category => {
        const categoryDiv = document.createElement("div");
        categoryDiv.className = "category";
        const header = document.createElement("h2");
        header.textContent = category;
        categoryDiv.appendChild(header);

        menuItems[category].forEach(item => {
          const el = document.createElement("div");
          el.className = "menu-item";
          let extraOption = "";
          if (item.name === "æ¦¨èœè‚‰çµ²éºµ(æ¹¯/ä¹¾)") {
            extraOption = `
              <div class="quantity-group">
                æ¹¯/ä¹¾ï¼š
                <select class="soup-option">
                  <option value="æ¹¯">æ¹¯</option>
                  <option value="ä¹¾">ä¹¾</option>
                </select>
              </div>
            `;
          }
          el.innerHTML = `
            <div class="item-info">${item.name} - ${item.price} å…ƒ</div>
            <div class="quantity-group">
              æ•¸é‡ï¼š
              <select class="quantity">
                ${[...Array(10).keys()].map(i => `<option value="${i+1}">${i+1}</option>`).join("")}
              </select>
            </div>
            ${extraOption}
            <button class="btn" onclick="addToCart(this, '${item.name}', ${item.price})">åŠ å…¥è³¼ç‰©è»Š</button>
          `;
          categoryDiv.appendChild(el);
        });

        menuDiv.appendChild(categoryDiv);
      });
    }

    function addToCart(button, name, price) {
      const parentItem = button.closest('.menu-item');
      const quantity = parseInt(parentItem.querySelector(".quantity").value);
      const soupOptionElement = parentItem.querySelector(".soup-option");
      let soupOption = '';
      if (soupOptionElement) {
        soupOption = soupOptionElement.value;
      }
      const itemName = soupOption ? `${name.split('(')[0].trim()} (${soupOption})` : name; // ä¿®æ­£åç¨±é¡¯ç¤º
      
      const existing = cart.find(item => item.name === itemName);
      if (existing) {
        existing.quantity += quantity;
      } else {
        cart.push({ name: itemName, price, quantity });
      }
      showToast(`å·²åŠ å…¥ ${quantity} ä»½ ${itemName}`);
    }

    function showMenu() {
      document.getElementById("menu-view").style.display = "block";
      document.getElementById("cart-view").style.display = "none";
      document.getElementById("success-view").style.display = "none";
      renderMenu();
    }

    function showCart() {
      document.getElementById("menu-view").style.display = "none";
      document.getElementById("cart-view").style.display = "block";
      document.getElementById("success-view").style.display = "none";

      const list = document.getElementById("cart-list");
      const totalEl = document.getElementById("total");
      list.innerHTML = "";
      let total = 0;
      cart.forEach((item, index) => {
        const li = document.createElement("li");
        
        // å¢åŠ åˆªé™¤æŒ‰éˆ•
        li.innerHTML = `
          <span>${item.name} x ${item.quantity} - ${item.price * item.quantity} å…ƒ</span>
          <button class="btn btn-small" style="background-color: #dc3545;" onclick="deleteCartItem(${index})">åˆªé™¤</button>
        `;
        list.appendChild(li);
        total += item.price * item.quantity;
      });
      totalEl.textContent = total;
      document.getElementById("message").textContent = "";
    }
    
    // å¢åŠ åˆªé™¤è³¼ç‰©è»Šå–®ä¸€é …ç›®åŠŸèƒ½
    function deleteCartItem(index) {
        if (confirm("ç¢ºå®šè¦å¾è³¼ç‰©è»Šä¸­åˆªé™¤æ­¤å•†å“å—ï¼Ÿ")) {
            cart.splice(index, 1);
            showCart(); // é‡æ–°é¡¯ç¤ºè³¼ç‰©è»Š
            showToast("å•†å“å·²å¾è³¼ç‰©è»Šä¸­åˆªé™¤ã€‚");
        }
    }


    function removeItems() {
      cart.length = 0;
      showCart();
      document.getElementById("message").textContent = "è³¼ç‰©è»Šå·²æ¸…ç©ºã€‚";
    }

    function toggleAddress() {
      const orderType = document.getElementById("orderType").value;
      document.getElementById("addressGroup").style.display = orderType === "å¤–é€" ? "block" : "none";
    }

    function toggleInvoiceFields() {
      const type = document.getElementById("invoiceType").value;
      document.getElementById("carrierGroup").style.display = type === "è¼‰å…·" ? "block" : "none";
      document.getElementById("taxIdGroup").style.display = type === "çµ±ç·¨" ? "block" : "none";
    }
    
    function toggleBarcode() {
      const payment = document.getElementById("payment").value;
      const barcodeGroup = document.getElementById("barcodeGroup");
      const barcodeLabel = document.getElementById("barcodeLabel");

      if (payment === "LINE PAY" || payment === "APPLE PAY") {
        barcodeGroup.style.display = "block";
        barcodeLabel.textContent = `è«‹è¼¸å…¥ ${payment} ä»˜æ¬¾ç¢¼ï¼š`;
      } else {
        barcodeGroup.style.display = "none";
      }
    }


    function submitOrder() {
      if (cart.length === 0) {
        document.getElementById("message").textContent = "è«‹å…ˆé¸æ“‡é¤é»å–”ï¼";
        return;
      }

      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const orderType = document.getElementById("orderType").value;
      const address = document.getElementById("address").value;
      const payment = document.getElementById("payment").value;
      const notes = document.getElementById("notes").value; // æ–°å¢å‚™è¨»æ¬„ä½

      const invoiceType = document.getElementById("invoiceType").value;
      const barcodeInput = document.getElementById("barcodeInput").value;

      const carrier = document.getElementById("carrier").value;
      const taxId = document.getElementById("taxId").value;
      const totalAmount = document.getElementById("total").textContent;


      // --- å¿…å¡«æ¬„ä½æª¢æŸ¥ ---
      if ((payment === "LINE PAY" || payment === "APPLE PAY") && !barcodeInput) {
        document.getElementById("message").textContent = `è«‹è¼¸å…¥ ${payment} çš„ä»˜æ¬¾ç¢¼ã€‚`;
        return;
      }

      if (!name || !phone || (orderType === "å¤–é€" && !address)) {
        document.getElementById("message").textContent = "è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½ã€‚";
        return;
      }
      
      if (invoiceType === "è¼‰å…·" && !carrier) {
          document.getElementById("message").textContent = "è«‹è¼¸å…¥è¼‰å…·æ¢ç¢¼ã€‚";
          return;
      }

      if (invoiceType === "çµ±ç·¨" && !taxId) {
          document.getElementById("message").textContent = "è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿã€‚";
          return;
      }
      // --- å¿…å¡«æ¬„ä½æª¢æŸ¥çµæŸ ---
      
      // 1. å»ºç«‹å®Œæ•´çš„è¨‚å–®è³‡æ–™ç‰©ä»¶
      const orderData = {
          timestamp: new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' }), // ç´€éŒ„é€å‡ºæ™‚é–“
          name: name,
          phone: phone,
          orderType: orderType,
          address: orderType === "å¤–é€" ? address : "N/A",
          payment: payment,
          paymentBarcode: (payment === "LINE PAY" || payment === "APPLE PAY") ? barcodeInput : "N/A",
          invoiceType: invoiceType,
          carrier: invoiceType === "è¼‰å…·" ? carrier : "N/A",
          taxId: invoiceType === "çµ±ç·¨" ? taxId : "N/A",
          notes: notes, // æ–°å¢
          totalAmount: parseInt(totalAmount),
          items: JSON.parse(JSON.stringify(cart)), // è¤‡è£½è³¼ç‰©è»Šå…§å®¹
          store: "é¤é£²åº—", // æ¨™è¨˜æ˜¯å“ªå€‹åº—çš„è¨‚å–®
          status: "æ–°è¨‚å–®"
      };
      
      // 2. è®€å–ç¾æœ‰çš„å„²å­˜è³‡æ–™
      const STORAGE_KEY = 'lunlunRestaurantOrders'; // é¤é£²åº—å°ˆç”¨çš„ Key
      let existingOrdersJSON = localStorage.getItem(STORAGE_KEY);
      
      let existingOrders;
      try {
          existingOrders = existingOrdersJSON ? JSON.parse(existingOrdersJSON) : [];
      } catch (e) {
          console.error("è§£ææœ¬åœ°å„²å­˜è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œå°‡è¦†è“‹èˆŠè³‡æ–™ï¼š", e);
          existingOrders = [];
      }
      
      // 3. å°‡æ–°çš„è¨‚å–®åŠ å…¥é™£åˆ—
      existingOrders.push(orderData);

      // 4. å­˜å› localStorage
      try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(existingOrders));
          console.log("ã€è¨‚å–®å·²æˆåŠŸæœ¬åœ°å„²å­˜ã€‘", orderData);
      } catch (e) {
          console.error("æœ¬åœ°å„²å­˜è¨‚å–®æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š", e);
      }

      // 5. é¡¯ç¤ºæˆåŠŸç•«é¢ä¸¦æ¸…ç©º
      document.getElementById("cart-view").style.display = "none";
      document.getElementById("success-view").style.display = "block";
      
      // æ¸…ç©ºè³¼ç‰©è»ŠåŠè¡¨å–® (èˆ‡æ‚¨åŸæœ‰é‚è¼¯ç›¸åŒ)
      cart.length = 0; 
      document.getElementById("name").value = "";
      document.getElementById("phone").value = "";
      document.getElementById("address").value = "";
      document.getElementById("barcodeInput").value = "";
      document.getElementById("carrier").value = "";
      document.getElementById("taxId").value = "";
      document.getElementById("notes").value = ""; // æ–°å¢
      document.getElementById("message").textContent = "";
    }
    // ---------------------------------------------
    
    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 2000);
    }


    showMenu(); // é¦–æ¬¡è¼‰å…¥é é¢æ™‚é¡¯ç¤ºèœå–®
    renderMenu(); // é¦–æ¬¡è¼‰å…¥é é¢æ™‚æ¸²æŸ“èœå–®
  </script>

<div id="toast" style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
 background-color:#333; color:#fff; padding:10px 20px; border-radius:5px; font-size:16px; z-index:1000;">
 å·²åŠ å…¥è³¼ç‰©è»Šï¼
</div>

</body>
</html>
